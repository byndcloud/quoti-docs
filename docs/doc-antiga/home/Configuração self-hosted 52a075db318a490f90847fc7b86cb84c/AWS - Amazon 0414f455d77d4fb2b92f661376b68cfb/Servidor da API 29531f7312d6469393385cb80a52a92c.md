# Servidor da API

Owner: Levi N√≥brega

Para configurarmos os containers utilizaremos o Amazon ECS

<aside>
üí° **Amazon ECS** facilita a implanta√ß√£o, o gerenciamento e o dimensionamento de cont√™ineres do Docker que executam aplicativos, servi√ßos e processos em lote. O Amazon ECS coloca cont√™ineres em seu cluster com base em suas necessidades de recursos e √© integrado a recursos conhecidos como Elastic Load Balancing, grupos de seguran√ßa do EC2, volumes do EBS e fun√ß√µes do IAM.

</aside>

**‚Üí Nosso container √© constru√≠do utilizando a tecnologia Docker**

- Utilizamos o Container Registiry do Google Cloud como reposit√≥rio de imagens de container, disponibilizaremos a URL para download das imagens e chaves de autentica√ß√£o para que possa ser integrado via CI/CD o deployment autom√°tico de imagens do nosso container.
- Dentro do container temos:
    - Imagem
        - node:14-alpine
    - Softwares instalados
        - python3
        - py3-pip
        - libreoffice
        - bash
        - curl
        - mc
        - util-linux
- O Container requer as seguintes vari√°veis de ambiente para bom funcionamento

```jsx
APP_ID=whitelabel-app
PORT=**
NODE_ENV=production
LOG_LEVEL=info
REQUEST_LIMIT=999kb
SESSION_SECRET=mySecret
OPENAPI_SPEC=/api/v1/spec
DATABASE_HOST=0.0.0.0
DATABASE_USER=myUser
DATABASE_PORT=**
DATABASE_PASSWORD=myPassword
DATABASE_ORGANIZATION_MANAGER_USER=myUser
DATABASE_ORGANIZATION_MANAGER_PASSWORD=myPassword
```

- Especifica√ß√µes de dimensionamento recomendadas por inst√¢ncia de container
    - 1 vCPU
    - 1 GB Ram
- Docker Compose

```jsx
version: '3'
services:
  api:
    image: gcr.io/${PROJECT_ID}/api-${_TRIGGER_ENV}:${COMMIT_SHA}
    build: 
      context: .
      target: ${_TARGET_BUILD}
    container_name: whitelabel-api
    restart: always
    command:
      "npm run start"
```

- Volumetria

| Qtd de Inst√¢ncias | Requests p/ segundo | Usu√°rios simult√¢neos | Usu√°rios p/ dia |
| --- | --- | --- | --- |
| 1 | 3 - 5 | 30 - 50 | 4.000 |
| 4 | 6 - 15 | 51 - 200 | 15.000 |
| 8 | 15 - 30 | 201 - 1000 | 50.000 |